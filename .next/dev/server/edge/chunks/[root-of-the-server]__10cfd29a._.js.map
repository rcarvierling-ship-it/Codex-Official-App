{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/nav.ts"],"sourcesContent":["export type Role =\n  | \"SUPER_ADMIN\"\n  | \"ADMIN\"\n  | \"AD\"\n  | \"COACH\"\n  | \"OFFICIAL\"\n  | \"USER\";\n\nexport type NavItem = {\n  label: string;\n  href: string;\n};\n\nexport const DEFAULT_ROLE: Role = \"USER\";\n\nconst PATH_LABELS: Record<string, string> = {\n  \"/admin\": \"Overview\",\n  \"/admin/leagues\": \"Leagues\",\n  \"/admin/schools\": \"Schools\",\n  \"/admin/teams\": \"Teams\",\n  \"/admin/venues\": \"Venues\",\n  \"/events\": \"Events\",\n  \"/officials\": \"Officials\",\n  \"/requests\": \"Requests\",\n  \"/approvals\": \"Approvals\",\n  \"/assignments\": \"Assignments\",\n  \"/announcements\": \"Announcements\",\n  \"/admin/users\": \"Users & Roles\",\n  \"/admin/feature-flags\": \"Feature Flags\",\n  \"/admin/settings\": \"Settings\",\n  \"/analytics\": \"Analytics\",\n  \"/activity\": \"Activity\",\n  \"/api-explorer\": \"API Explorer\",\n  \"/dev-tools\": \"Dev Tools\",\n  \"/teams\": \"Teams\",\n  \"/venues\": \"Venues\",\n  \"/profile\": \"Profile\",\n};\n\nconst ROLE_NAV_PATHS: Record<Role, string[]> = {\n  SUPER_ADMIN: [\n    \"/admin\",\n    \"/admin/leagues\",\n    \"/admin/schools\",\n    \"/admin/teams\",\n    \"/admin/venues\",\n    \"/events\",\n    \"/officials\",\n    \"/requests\",\n    \"/approvals\",\n    \"/assignments\",\n    \"/announcements\",\n    \"/admin/users\",\n    \"/admin/feature-flags\",\n    \"/admin/settings\",\n    \"/analytics\",\n    \"/activity\",\n    \"/api-explorer\",\n    \"/dev-tools\",\n  ],\n  ADMIN: [\n    \"/admin\",\n    \"/events\",\n    \"/requests\",\n    \"/approvals\",\n    \"/assignments\",\n    \"/teams\",\n    \"/officials\",\n    \"/venues\",\n    \"/announcements\",\n    \"/admin/users\",\n    \"/admin/settings\",\n    \"/analytics\",\n    \"/activity\",\n  ],\n  AD: [\n    \"/admin\",\n    \"/events\",\n    \"/requests\",\n    \"/approvals\",\n    \"/assignments\",\n    \"/teams\",\n    \"/officials\",\n    \"/venues\",\n    \"/announcements\",\n    \"/activity\",\n  ],\n  COACH: [\n    \"/admin\",\n    \"/teams\",\n    \"/events\",\n    \"/requests\",\n    \"/announcements\",\n  ],\n  OFFICIAL: [\n    \"/admin\",\n    \"/events\",\n    \"/requests\",\n    \"/assignments\",\n    \"/profile\",\n  ],\n  USER: [\n    \"/admin\",\n    \"/events\",\n    \"/announcements\",\n  ],\n};\n\nexport const KNOWN_ROLES: Role[] = Object.keys(ROLE_NAV_PATHS) as Role[];\n\nexport function isRole(value: unknown): value is Role {\n  return typeof value === \"string\" && (KNOWN_ROLES as string[]).includes(value);\n}\n\nexport function normalizeRole(value: unknown): Role {\n  if (isRole(value)) return value;\n  if (value === \"STAFF\") return \"USER\";\n  return DEFAULT_ROLE;\n}\n\nexport function getNavForRole(role: Role): NavItem[] {\n  const paths = ROLE_NAV_PATHS[role] ?? ROLE_NAV_PATHS[DEFAULT_ROLE];\n  return paths.map((href) => ({\n    href,\n    label: PATH_LABELS[href] ?? href.replace(\"/\", \"\").replace(/-/g, \" \"),\n  }));\n}\n\nexport function getAllNavPaths(): string[] {\n  const set = new Set<string>();\n  KNOWN_ROLES.forEach((role) => {\n    ROLE_NAV_PATHS[role].forEach((path) => set.add(path));\n  });\n  return Array.from(set);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAaO,MAAM,eAAqB;AAElC,MAAM,cAAsC;IAC1C,UAAU;IACV,kBAAkB;IAClB,kBAAkB;IAClB,gBAAgB;IAChB,iBAAiB;IACjB,WAAW;IACX,cAAc;IACd,aAAa;IACb,cAAc;IACd,gBAAgB;IAChB,kBAAkB;IAClB,gBAAgB;IAChB,wBAAwB;IACxB,mBAAmB;IACnB,cAAc;IACd,aAAa;IACb,iBAAiB;IACjB,cAAc;IACd,UAAU;IACV,WAAW;IACX,YAAY;AACd;AAEA,MAAM,iBAAyC;IAC7C,aAAa;QACX;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,IAAI;QACF;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,OAAO;QACL;QACA;QACA;QACA;QACA;KACD;IACD,UAAU;QACR;QACA;QACA;QACA;QACA;KACD;IACD,MAAM;QACJ;QACA;QACA;KACD;AACH;AAEO,MAAM,cAAsB,OAAO,IAAI,CAAC;AAExC,SAAS,OAAO,KAAc;IACnC,OAAO,OAAO,UAAU,YAAY,AAAC,YAAyB,QAAQ,CAAC;AACzE;AAEO,SAAS,cAAc,KAAc;IAC1C,IAAI,OAAO,QAAQ,OAAO;IAC1B,IAAI,UAAU,SAAS,OAAO;IAC9B,OAAO;AACT;AAEO,SAAS,cAAc,IAAU;IACtC,MAAM,QAAQ,cAAc,CAAC,KAAK,IAAI,cAAc,CAAC,aAAa;IAClE,OAAO,MAAM,GAAG,CAAC,CAAC,OAAS,CAAC;YAC1B;YACA,OAAO,WAAW,CAAC,KAAK,IAAI,KAAK,OAAO,CAAC,KAAK,IAAI,OAAO,CAAC,MAAM;QAClE,CAAC;AACH;AAEO,SAAS;IACd,MAAM,MAAM,IAAI;IAChB,YAAY,OAAO,CAAC,CAAC;QACnB,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,OAAS,IAAI,GAAG,CAAC;IACjD;IACA,OAAO,MAAM,IAAI,CAAC;AACpB"}},
    {"offset": {"line": 149, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/acl.ts"],"sourcesContent":["import { getAllNavPaths, getNavForRole, type Role } from \"./nav\";\n\nconst alwaysAllowed = new Set([\"/\", \"/demo\"]);\n\nexport function pathMatches(base: string, pathname: string) {\n  if (base === \"/\") return pathname === \"/\";\n  if (!base.startsWith(\"/\")) return false;\n  return pathname === base || pathname.startsWith(`${base}/`);\n}\n\nexport function roleAllows(role: Role, pathname: string): boolean {\n  if (alwaysAllowed.has(pathname)) return true;\n  const allowed = getNavForRole(role);\n  return allowed.some((item) => pathMatches(item.href, pathname));\n}\n\nconst PROTECTED_BASE_PATHS = Array.from(\n  new Set([\n    \"/admin\",\n    \"/events\",\n    \"/officials\",\n    \"/requests\",\n    \"/approvals\",\n    \"/assignments\",\n    \"/announcements\",\n    \"/teams\",\n    \"/venues\",\n    \"/admin/leagues\",\n    \"/admin/schools\",\n    \"/admin/teams\",\n    \"/admin/venues\",\n    \"/admin/users\",\n    \"/admin/feature-flags\",\n    \"/admin/settings\",\n    \"/analytics\",\n    \"/activity\",\n    \"/api-explorer\",\n    \"/dev-tools\",\n    \"/profile\",\n  ]),\n);\n\ngetAllNavPaths().forEach((path) => PROTECTED_BASE_PATHS.push(path));\n\nexport const GUARDED_PREFIXES = Array.from(new Set(PROTECTED_BASE_PATHS));\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,gBAAgB,IAAI,IAAI;IAAC;IAAK;CAAQ;AAErC,SAAS,YAAY,IAAY,EAAE,QAAgB;IACxD,IAAI,SAAS,KAAK,OAAO,aAAa;IACtC,IAAI,CAAC,KAAK,UAAU,CAAC,MAAM,OAAO;IAClC,OAAO,aAAa,QAAQ,SAAS,UAAU,CAAC,GAAG,KAAK,CAAC,CAAC;AAC5D;AAEO,SAAS,WAAW,IAAU,EAAE,QAAgB;IACrD,IAAI,cAAc,GAAG,CAAC,WAAW,OAAO;IACxC,MAAM,UAAU,IAAA,0IAAa,EAAC;IAC9B,OAAO,QAAQ,IAAI,CAAC,CAAC,OAAS,YAAY,KAAK,IAAI,EAAE;AACvD;AAEA,MAAM,uBAAuB,MAAM,IAAI,CACrC,IAAI,IAAI;IACN;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAGH,IAAA,2IAAc,IAAG,OAAO,CAAC,CAAC,OAAS,qBAAqB,IAAI,CAAC;AAEtD,MAAM,mBAAmB,MAAM,IAAI,CAAC,IAAI,IAAI"}},
    {"offset": {"line": 202, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\nimport { getToken } from \"next-auth/jwt\";\n\nimport { GUARDED_PREFIXES, roleAllows } from \"@/lib/acl\";\nimport { normalizeRole, type Role } from \"@/lib/nav\";\n\nconst ROLE_COOKIE = \"theofficialapp-role\";\nconst TOAST_COOKIE = \"x-toast\";\n\nfunction needsGuard(pathname: string) {\n  return GUARDED_PREFIXES.some(\n    (prefix) => pathname === prefix || pathname.startsWith(`${prefix}/`),\n  );\n}\n\nexport async function middleware(req: NextRequest) {\n  const { pathname } = req.nextUrl;\n  if (!needsGuard(pathname)) {\n    return NextResponse.next();\n  }\n\n  const token = await getToken({ req, secret: process.env.NEXTAUTH_SECRET });\n  const tokenRole = token?.role as Role | undefined;\n  const cookieRole = req.cookies.get(ROLE_COOKIE)?.value as Role | undefined;\n  const role: Role = normalizeRole(tokenRole ?? cookieRole);\n\n  if (roleAllows(role, pathname)) {\n    const res = NextResponse.next();\n    res.cookies.set(ROLE_COOKIE, role, { path: \"/\", httpOnly: false });\n    return res;\n  }\n\n  const destination = role === \"OFFICIAL\" ? \"/admin\" : \"/\";\n  const redirectUrl = req.nextUrl.clone();\n  redirectUrl.pathname = destination;\n  redirectUrl.searchParams.set(\"from\", pathname);\n\n  const res = NextResponse.redirect(redirectUrl);\n  res.cookies.set(TOAST_COOKIE, \"unauthorized\", {\n    path: \"/\",\n    httpOnly: false,\n    sameSite: \"lax\",\n  });\n  return res;\n}\n\nexport const config = {\n  matcher: [\n    \"/admin/:path*\",\n    \"/events/:path*\",\n    \"/officials/:path*\",\n    \"/requests/:path*\",\n    \"/approvals/:path*\",\n    \"/assignments/:path*\",\n    \"/announcements/:path*\",\n    \"/teams/:path*\",\n    \"/venues/:path*\",\n    \"/analytics/:path*\",\n    \"/activity/:path*\",\n    \"/api-explorer/:path*\",\n    \"/dev-tools/:path*\",\n    \"/profile/:path*\",\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;AAEA;AACA;;;;;AAEA,MAAM,cAAc;AACpB,MAAM,eAAe;AAErB,SAAS,WAAW,QAAgB;IAClC,OAAO,6IAAgB,CAAC,IAAI,CAC1B,CAAC,SAAW,aAAa,UAAU,SAAS,UAAU,CAAC,GAAG,OAAO,CAAC,CAAC;AAEvE;AAEO,eAAe,WAAW,GAAgB;IAC/C,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAChC,IAAI,CAAC,WAAW,WAAW;QACzB,OAAO,iWAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,QAAQ,MAAM,IAAA,qXAAQ,EAAC;QAAE;QAAK,QAAQ,QAAQ,GAAG,CAAC,eAAe;IAAC;IACxE,MAAM,YAAY,OAAO;IACzB,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc;IACjD,MAAM,OAAa,IAAA,0IAAa,EAAC,aAAa;IAE9C,IAAI,IAAA,uIAAU,EAAC,MAAM,WAAW;QAC9B,MAAM,MAAM,iWAAY,CAAC,IAAI;QAC7B,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa,MAAM;YAAE,MAAM;YAAK,UAAU;QAAM;QAChE,OAAO;IACT;IAEA,MAAM,cAAc,SAAS,aAAa,WAAW;IACrD,MAAM,cAAc,IAAI,OAAO,CAAC,KAAK;IACrC,YAAY,QAAQ,GAAG;IACvB,YAAY,YAAY,CAAC,GAAG,CAAC,QAAQ;IAErC,MAAM,MAAM,iWAAY,CAAC,QAAQ,CAAC;IAClC,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,gBAAgB;QAC5C,MAAM;QACN,UAAU;QACV,UAAU;IACZ;IACA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;AACH"}}]
}